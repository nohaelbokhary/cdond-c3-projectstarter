---
  - name: "create beckend directory"
    become: true
    copy:
       src: artifact.tar.gz
       dest: /home/ubuntu

  - name: "unarchive backend directory"
    become: true
    unarchive:
        src: artifact.tar.gz
        dest: /home/ubuntu
   

  - name: "installing Node Dependencies "
    shell: |
      cd /home/ubuntu/backend
      npm i


  - name: "Executing node app with pm2"
    become: true
    shell: |
      cd /home/ubuntu/backend/dist
      pm2 stop default
      pm2 start main.js

   
     
    register: execute_node


 
  - name: "configure pm2 to start as aservice"
    become: true
    shell: |
      env PATH=$PATH:/usr/local/bin pm2 startup systemd -u ubuntu --hp /home/ubuntu

    
